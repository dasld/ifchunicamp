%%
%% Customizações do abnTeX2 (http://www.abntex.net.br/) para dissertações e teses do IFCH/Unicamp
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `maintained'.
%%
%% The Current Maintainer of this work is Daniel Alves da Silva Lopes Diniz, diniz.cpm <at> gmail.com
%%
%% Further information about abnTeX2 are available on http://www.abntex.net.br/
%%

% ---
% INICIO DAS CUSTOMIZAÇÔES PARA O IFCH/UNICAMP
% ---

% Este pacote procura alterar a capa e a folha de rosto da classe abnTeX2 de modo a
% ficarem compatíveis com as normas para Dissertações e Teses do IFCH/Unicamp.
% Essas normas estão disponíveis em
% https://www.ifch.unicamp.br/ifch/pf-ifch/public-files/pos/procedimentos/manual_defesa_v29_2018.pdf
% (acesso em 22/06/2019).

\NeedsTeXFormat{LaTeX2e}
% segundo o documento "LATEX2e for class and package writers", a data do pacote
% deve ser a primeira (ou única) informação no argumento opcional de \ProvidesPackage
% e vir no formato YYYY-MM-DD
\ProvidesPackage{ifchunicamp}[2022/07/17]
\RequirePackage[utf8]{inputenc}%  este documento deve ser lido em UTF-8
\RequirePackage{xkeyval}
% hyperref para o comando \pdfbookmark
\@ifpackageloaded{hyperref}
  {\PassOptionsToPackage{bookmarksopen=1,unicode}{hyperref}}
  {\RequirePackage[bookmarksopen=1,unicode]{hyperref}}
\@ifpackageloaded{graphicx}
  {\PassOptionsToPackage{pdftex}{graphicx}}
  {\RequirePackage[pdftex]{graphicx}}



% -- subtítulo
% https://github.com/abntex/abntex2/blob/f0a4d3c8589f0f2e7c087880f0816debda036eb4/tex/latex/abntex2/abntex2.cls#L697
\newcommand{\imprimirsubtitulo}{}
\newcommand{\subtitulo}[1]{\renewcommand{\imprimirsubtitulo}{#1}}
\newcommand{\imprimirsubtitulo@ifchunicamp}{%
  \abntex@ifnotempty{\imprimirsubtitulo}{%
    {:}\par\MakeUppercase{\imprimirsubtitulo}
  }%
}



% -- opção "semlogo"
% 13,91mm é a média entre as alturas mínima e máxima
% permitidas pela Unicamp para seu logotipo
\newcommand{\logodaunic@mp}{\includegraphics[height=13.91mm]{logo.pdf}}
% a linha abaixo permite usar
% \usepackage[semlogo=?]
% onde ? é QUALQUER valor, o que eu acho meio estranho,
% embora pacotes como geometry usem essa convenção.
% \define@key{capaifch}{semlogo}[]{\def\logodaunic@mp{}}
% acho mais lógico usar essa outra definição, que
% permite apenas as sintaxes:
% \usepackage[semlogo] / \usepackage[semlogo=true] (equivalentes)
% \usepackage[semlogo=false] (correto, porém inócuo)
\define@boolkey{capaifch}{semlogo}[true]{\ifstrequal{#1}{true}{\def\logodaunic@mp{}}}

% -- opção "naofinal"
\newsavebox{\versaofinaldaunic@mpbox}
\newcommand{\versaofinaldaunic@mp}{\usebox{\versaofinaldaunic@mpbox}}
\define@boolkey{capaifch}{naofinal}[true]{%
  \ifstrequal{#1}{true}{%
    \def\versaofinaldaunic@mp{\phantom{\usebox{\versaofinaldaunic@mpbox}}}%
  }%
}

% -- opção "peloaluno"
\newcommand*{\peloalunounic@mp}{pelo aluno}
\define@key{capaifch}{peloaluno}{\def\peloalunounic@mp{#1}}


% usando \ProcessOptionsX em vez de
% \ProcessOptions devido ao pacote xkeyval
% a especificação da família entre <> é obrigatória
\ProcessOptionsX<capaifch>\relax


% == CAPA ==
\renewcommand{\imprimircapa}{%
% cf. abntex2.pdf p13 pra mais informações
\pdfbookmark{Capa}{capa}
\begin{capa}
  \setlength{\parindent}{\z@}%
% LOGOTIPO
\logodaunic@mp

\centering
\ABNTEXchapterfont

% INSTITUIÇÃO
% \MakeUppercase e \MakeTextUppercase não funcionam (mais?) aqui,
% mesmo com \expandafter; mas \uppercase (ainda) funciona
\textbf{\Large\expandafter\uppercase\expandafter{\imprimirinstituicao}}

% AUTOR
\vspace*{3\onelineskip}%
\MakeUppercase{\large\imprimirautor}

% TÍTULO
\vfill%
% vplace é definido pela classe memoir (base de abnTeX2)
% "the optional argument specifies the ratio of the upper space to the lower space"
\begin{vplace}[0]
  \centering\LARGE%
  \MakeUppercase{\bfseries\imprimirtitulo}%
  \imprimirsubtitulo@ifchunicamp
\end{vplace}

% LOCAL E DATA
\vfill%
\large%
\MakeUppercase{\imprimirlocal}\\
\imprimirdata
\end{capa}
}



% == FOLHA DE ROSTO ==
\renewcommand{\folhaderostocontent}{%
  \setlength{\parindent}{0cm}%
\centering%
\rmfamily%
% AUTOR
\MakeUppercase{\large\imprimirautor}

% TÍTULO
\vspace*{\stretch{4}}%
\begin{vplace}[0]
\begingroup%
\ABNTEXchapterfont\Large%
  \MakeUppercase{\imprimirtitulo}%
  \imprimirsubtitulo@ifchunicamp
\endgroup

% PREÂMBULO
\vspace*{\stretch{3}}%
\abntex@ifnotempty{\imprimirpreambulo}{%
\hspace*{\fill}%
\parbox{.5\textwidth}{\SingleSpacing\imprimirpreambulo}%
}

\flushleft%
% ORIENTAÇÃO
\vspace*{\stretch{1}}%
\textit{\imprimirorientadorRotulo}:\enspace\imprimirorientador
\abntex@ifnotempty{\imprimircoorientador}{%
  \newline\textit{\imprimircoorientadorRotulo}:\enspace\imprimircoorientador
}

% VERSÃO FINAL
\vspace*{\stretch{2}}%
\savebox{\versaofinaldaunic@mpbox}{%
  \parbox{.5\textwidth}{\MakeUppercase{%
    \ABNTEXfontereduzida
    Este exemplar corresponde à versão final da tese defendida
    \peloalunounic@mp\ %
    \imprimirautor,
    orientada por
    \imprimirorientador.%
  }}%
}%
\versaofinaldaunic@mp
\end{vplace}

\vspace*{\stretch{4}}%
% LOCAL E DATA
\centering\large%\bfseries%
\MakeUppercase{\imprimirlocal}\\
\imprimirdata%
}

% ---
% FIM DAS CUSTOMIZAÇÔES
% ---
