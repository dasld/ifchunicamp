%%
%% Customizações do abnTeX2 (http://www.abntex.net.br/) para dissertações e teses do IFCH/Unicamp
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `maintained'.
%%
%% The Current Maintainer of this work is Daniel Alves da Silva Lopes Diniz, diniz.cpm <at> gmail.com
%%
%% Further information about abnTeX2 are available on http://www.abntex.net.br/
%%

% ---
% INICIO DAS CUSTOMIZAÇÔES PARA O IFCH/UNICAMP
% ---

% Este pacote procura alterar a capa e a folha de rosto da classe abnTeX2 de modo a
% ficarem compatíveis com as normas para Dissertações e Teses do IFCH/Unicamp.
% Essas normas estão disponíveis em
% https://www.ifch.unicamp.br/ifch/pf-ifch/public-files/pos/procedimentos/manual_defesa_v29_2018.pdf
% (acesso em 22/06/2019).

\NeedsTeXFormat{LaTeX2e}
% segundo o documento "LATEX2e for class and package writers", a data do pacote
% deve ser a primeira (ou única) informação no argumento opcional de \ProvidesPackage
% e vir no formato YYYY-MM-DD
\ProvidesPackage{ifchunicamp}[2022/07/17]
\RequirePackage[utf8]{inputenc}%  este documento deve ser lido em UTF-8
% hyperref para o comando \pdfbookmark
\@ifpackageloaded{hyperref}
  {\PassOptionsToPackage{bookmarksopen=1,unicode}{hyperref}}
  {\RequirePackage[bookmarksopen=1,unicode]{hyperref}}
\@ifpackageloaded{graphicx}
  {\PassOptionsToPackage{pdftex}{graphicx}}
  {\RequirePackage[pdftex]{graphicx}}

% baseado em https://github.com/abntex/abntex2/blob/master/tex/latex/abntex2/abntex2.cls#L694
\providecommand{\thesubtitulo}[1]{}
\newcommand{\subtitulo}[1]{\renewcommand{\thesubtitulo}{#1}}
\newcommand{\imprimirsubtitulo}{\thesubtitulo}
% 13,91mm é a média entre as alturas mínima e máxima
% permitidas pela Unicamp para seu logotipo
\newcommand{\logodaunic@mp}{\includegraphics[height=13.91mm]{logo.pdf}}
\DeclareOption{semlogo}{\def\logodaunic@mp{\empty}}
\ProcessOptions\relax



% == CAPA ==
\renewcommand{\imprimircapa}{%
% cf. abntex2.pdf p13 pra mais informações
\pdfbookmark{Capa}{capa}
\begin{capa}
  \setlength{\parindent}{\z@}%
% LOGOTIPO
\logodaunic@mp

\centering%
\ABNTEXchapterfont%

% INSTITUIÇÃO
%\MakeUppercase{}% não funciona mais aqui! por quê?!
\textbf{\Large\imprimirinstituicao}

% AUTOR
\vspace*{3\onelineskip}%
\MakeUppercase{\large\imprimirautor}

% TÍTULO
\vfill%
% vplace é definido pela classe memoir (base de abnTeX2)
% "the optional argument specifies the ratio of the upper space to the lower space"
\begin{vplace}[0]
  \centering\LARGE%
  \MakeUppercase{\bfseries\imprimirtitulo}:

  \MakeUppercase{\imprimirsubtitulo}
\end{vplace}

% LOCAL E DATA
\vfill%
\large%
\MakeUppercase{\imprimirlocal}\\
\imprimirdata
\end{capa}
}



% == FOLHA DE ROSTO ==
\renewcommand{\folhaderostocontent}{%
  \setlength{\parindent}{0cm}%
\centering%
\rmfamily%
% AUTOR
\MakeUppercase{\large\imprimirautor}

% TÍTULO
\vspace*{\stretch{4}}%
\begin{vplace}[0]
\begingroup%
\ABNTEXchapterfont\Large%
\MakeUppercase{\imprimirtitulo}:

\MakeUppercase{\imprimirsubtitulo}%
\endgroup

% PREÂMBULO
\vspace*{\stretch{3}}%
\abntex@ifnotempty{\imprimirpreambulo}{%
\hspace*{\fill}%
\parbox{.5\textwidth}{\SingleSpacing\imprimirpreambulo}%
}

\flushleft%
% ORIENTAÇÃO
\vspace*{\stretch{1}}%
% esse "hack" funciona assim:
% como o coorientador é opcional, as macros
% \imprimirorientadorRotulo e
% \imprimirorientador
% podem expandir para caixas vazias.
% por isso, vamos setar box0 para ser o nome do coorientador,
% isto é, \imprimircoorientador
% se box0 tiver largura positiva (maior que 0pt),
% imprimimos
% \textit{\imprimircoorientadorRotulo}:\enspace\box0
% do contrário, imprimimos apenas um \strut
% o \strut é necessário por causa da quebra de linha \\ abaixo!
% sem ele, não haveria uma nova linha pra começar após a quebra
% \wd0 é a largura da caixa temporária zero
% \z@ significa 0pt (zero pontos)
\textit{\imprimirorientadorRotulo}:\enspace\imprimirorientador\\%
\setbox0\hbox{\imprimircoorientador}%
\ifdim\wd0>\z@%
  \textit{\imprimircoorientadorRotulo}:\enspace\box0%
  \else\strut%
\fi%

% VERSÃO FINAL
\vspace*{\stretch{2}}%
\parbox{.5\textwidth}{\MakeUppercase{\ABNTEXfontereduzida%
    Este exemplar corresponde à versão final da tese defendida pelo
    aluno \imprimirautor,
    orientada por \imprimirorientador.%
}}
\end{vplace}

\vspace*{\stretch{4}}%
% LOCAL E DATA
\centering\large%\bfseries%
\MakeUppercase{\imprimirlocal}\\
\imprimirdata%
}

% ---
% FIM DAS CUSTOMIZAÇÔES
% ---
